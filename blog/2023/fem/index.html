<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>FEM for 1D magnetotelluric modeling | Abhinav Pratap Singh</title> <meta name="author" content="Abhinav Pratap Singh"> <meta name="description" content="Finite element modeling for 1D magnetotelluric response"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8C%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://ayushinav.github.io/blog/2023/fem/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Abhinav </span>Pratap Singh</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">FEM for 1D magnetotelluric modeling</h1> <p class="post-meta">December 3, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/modeling"> <i class="fas fa-hashtag fa-sm"></i> modeling</a>   <a href="/blog/tag/geophysics"> <i class="fas fa-hashtag fa-sm"></i> geophysics</a>   <a href="/blog/tag/math"> <i class="fas fa-hashtag fa-sm"></i> math</a>   <a href="/blog/tag/code"> <i class="fas fa-hashtag fa-sm"></i> code</a>   </p> </header> <article class="post-content"> <h1 id="introduction">Introduction</h1> <h2 id="maxwells-equations">Maxwell’s equations</h2> <p>The theory for understanding the behaviour of electromagnetic waves often begin with their behaviour in vacuum, often governed by a set of four equations called Maxwell’s equations: <br> \begin{equation} \nabla \cdot E= -\rho_e/\epsilon_0 \label{Coulomb} \end{equation} \begin{equation} \nabla \times E= -\mu_0 \partial_t H \label{Faraday} \end{equation} \begin{equation} \nabla \cdot H= 0 \label{Gauss} \end{equation} \begin{equation} \nabla \times H= J+ \epsilon_0\partial_tE \label{Ampere} \end{equation}<br> where \(E\) is the electric field, \(H\) is the magnetic field, \(M_s\) is the magnetic field source, \(\rho\) is resistivity, \(\rho_e\) is the charge density, \(J\) is current density, \(\mu_0\) is the magnetic permeability of the free space, and \(\epsilon_0\) is the electrical permittivity of the free space. In the above set of equations, eqn. \eqref{Coulomb} is known as Coulomb’s law of Gauss’ law for electric fields, which describes the electric field generated by a charge distribution. However, in a medium, the Maxwell equations are also accompanied by the constitutive relations. In our case, while investigating the behaviour of electromagnetic fields inside the earth, only one relationship makes an innegligible difference: \(\begin{equation} J= \sigma E \label{Ohm} \end{equation}\\\)</p> <p>The above is referred as the Ohm’s law, which states that the electric current density \(J\) in a medium is directly proportional to the electric field \(E\) across it with the constant of proportiaonality being the electrical conductivity of the material \(\sigma\). Substituting this in eqn \eqref{Ampere}, we get \begin{equation} \nabla \times H= \sigma E+ \epsilon_0\partial_tE \label{Ampere_Ohm} \end{equation}<br> Beginning our derivation of the 1D MT partial diffferential equation, we take the curl of \eqref{Faraday},</p> <p>\begin{equation} \nabla \times \nabla \times E= -\mu_0 \partial_t \nabla \times H \end{equation}</p> <p>Substituting equation \eqref{Ampere} and making use of \eqref{Ohm}, we get</p> \[\nabla \times \nabla \times E= -\mu_0 \sigma \partial_t E - \epsilon_0 \partial_t^2E\] <p>Taking advantage of the vector identity \(\nabla \times \nabla \times A= \nabla(\nabla \cdot A)- \nabla^2 A\), this simplifies into</p> \[\nabla(\nabla \cdot E)- \nabla^2 E= -\mu_0 \sigma \partial_t E - \epsilon_0 \partial_t^2E\] <p>Now substituting \eqref{Coulomb} in the above, we get</p> \[\nabla(\rho/\epsilon_0)- \nabla^2 E= -\mu_0 \sigma \partial_t E - \epsilon_0 \partial_t^2E\] <p>Noting that charge density does not change a lot in time, the above simplifies to \begin{equation} - \nabla^2 E= -\mu_0 \sigma \partial_t E - \epsilon_0 \partial_t^2E<br> \label{pde_E} \end{equation} Taking the Fourier transform of the above with respect to \(t\), we have</p> \[- \nabla^2 E= -i \omega \mu_0 \sigma E + \omega^2 \epsilon_0 E\] <p>For the order of frequencies used in the MT method, the second term in the above expression is negligible compared to the first one. This is called the quasi-static approximation. Using this relation, we have</p> \[- \nabla^2 E= -i \omega \mu_0 \sigma E\] \[\nabla^2 E -i \omega \mu_0 \sigma E = 0\] <p>In 1D, this is equivalent to</p> \[\begin{align} \notag &amp; \frac{\partial^2 E}{\partial^2 z}- i \omega \mu \sigma E =0 \\ \notag &amp; \texttt{For} \quad k^2= i \omega \mu \sigma \\ &amp; \frac{\partial^2 E}{\partial^2 z}- k^2 E=0 \label{E2k} \end{align}\] <h1 id="methodology">Methodology</h1> <h2 id="getting-to-the-linear-system">Getting to the linear system</h2> <p>The idea of the finite element method is to approximate a function in some basis space. To implement the scheme, we need to write the eqn \ref{E2k} in its weak form. In order to do that, we multiply both sides of the equation by any function \(W(z)\), called the weight function.</p> \[\begin{align} \notag &amp; \frac{\partial^2 E}{\partial^2 z} W- k^2 E W=0 \\ \notag &amp; \texttt{Integrating bothe sides wrt} \quad z \\ \notag &amp; \int_{\Omega} \frac{\partial^2 E}{\partial^2 z} W dz- \int_{\Omega} k^2 E W dz=0 \\ \notag &amp; \texttt{where} \; \Omega \; \texttt{is the computational domain, spanning the model space.} \\ \notag &amp; \texttt{Integrating the first term by parts, we have} \\ \notag &amp; - \int_{\Omega} \frac{\partial E}{\partial z} \frac{\partial W}{\partial z} dz+ \bigg|W \frac{\partial E}{\partial z}\bigg|_{d \Omega}- \int_{\Omega} k^2 E W dz=0 \end{align}\] <p>The second term in the above equation \(\bigg|W \frac{\partial E}{\partial z}\bigg|_{d \Omega}\) is equivalent to \(\bigg|W \frac{\partial E}{\partial z}\bigg|_{0}^Z\), that is, an expression evaluated at the end points. These end points are used to apply the boundary conditions. In the above conditions, we set \(W\)= 0 at the boundaries. This means that the boundary condition (Neumann or Dirichlet) is strictly imposed which we will show later in detail and therefore the residue is zero. This allows us to apply the Dirichlet boundary conditions, which is what we require for the MT problems. This also makes the second term equal to 0 and we have \begin{equation} \int_{\Omega} \frac{\partial E}{\partial z} \frac{\partial W}{\partial z} dz+ \int_{\Omega} k^2 E W dz=0 \label{E2} \end{equation} Before we move on, we need to understand and implement the first line of this section, that is, express the \(E\) field using some known basis functions, say \(\phi(z)\). We can then write \begin{equation} E= \sum_i \alpha_i \phi_i + \phi_0 \label{E_hat} \end{equation} where \(\phi_i(z)\) represents the basis function in the \(i^{th}\) element scald by a factor \(\alpha_i\). For our implementation, we use the linear basis functions, more popularly called as the hat functions. <a href="#hat">This</a> shows the hat functions for a grid-space defined between 0 and 1. We use 6 hat functions in the figure, each centered on its own node, eg. the function \(\phi_1(z)\) is centered at the node 1 at \(z= 0.2\). It starts with a positive slope at \(z=0\), peaks at \(z=0.2\) and then slopes down until \(z=0.4\).</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/hat-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/hat-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/hat-1400.webp"></source> <img src="/assets/fem/hat.png" class="img-fluid rounded z-depth-1" width="450" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Hat functions for a sample gridspace [0,1]</figcaption> </figure> <p>Using eqn \ref{E_hat} in \ref{E2}, we have \begin{equation} \int_{\Omega} \sum_i \alpha_i \phi_i’ \frac{\partial W}{\partial z} dz+ \int_{\Omega} k^2 \sum_i \alpha_i \phi_i W dz=0 \label{E3} \end{equation} The finite element method also tries to approximate the weight function by expressing it in terms of some basis functions, much like what we have for \(E\) in eqn \ref{E2}. In principle, we can choose any basis function to approximate \(W\) but the most common and efficient way is by using Galerkin’s method, that is, by using the same basis used for \(E\) can be used for \(W\). We then have \begin{equation} W= \sum_j \beta_j \phi_j \label{What} \end{equation} Pulling out the \(j^{th}\) function from the above and plugging into eqn \ref{E3}, we have</p> \[\begin{align} \notag &amp; \int_{\Omega} \sum_i \alpha_i \phi_i' \beta_j \phi_j' dz+ \int_{\Omega} k^2 \sum_i \alpha_i \phi_i \beta_j \phi_j dz=0 \\ \notag &amp; \beta_j \; \texttt{being a scalar constant} \\ &amp; \int_{\Omega} \sum_i \alpha_i \phi_i(z)' \phi_j(z)' dz+ \int_{\Omega} k^2 \sum_i \alpha_i \phi_i(z) \phi_j(z) dz=0 \label{E4} \end{align}\] <p>Plugging different values \(j\), we can obtain the system of equations to be solve for \(\alpha_i\)’s. Let’s say we have the grid defined for 5 elements, like <a href="#hat">here</a>. The eqn \ref{E4} then looks like \(\begin{align} \notag &amp; (j=0) \\ \notag &amp; \int_0^1 \alpha_0 \phi_0' \phi_0'+ \alpha_1 \phi_1' \phi_0'+ \dots \alpha_5 \phi_5' \phi_0' dz+ \int_0^1 k^2 \alpha_0 \phi_0 \phi_0+ \alpha_1 \phi_1 \phi_0+ \dots \alpha_5 \phi_5 \phi_0 dz=0 \\ \notag &amp; (j=1) \\ \notag &amp; \int_0^1 \alpha_0 \phi_0' \phi_1'+ \alpha_1 \phi_1' \phi_1'+ \dots \alpha_5 \phi_5' \phi_1' dz+ \int_0^1 k^2 \alpha_0 \phi_0 \phi_1+ \alpha_1 \phi_1 \phi_1+ \dots \alpha_5 \phi_5 \phi_1 dz=0 \\ \notag \vdots \\ \notag &amp; (j=5) \\ \notag &amp; \int_0^1 \alpha_0 \phi_0' \phi_5'+ \alpha_1 \phi_1' \phi_5'+ \dots \alpha_5 \phi_5' \phi_5' dz+ \int_0^1 k^2 \alpha_0 \phi_0 \phi_5+ \alpha_1 \phi_1 \phi_5+ \dots \alpha_5 \phi_5 \phi_5 dz=0 \\ \end{align}\)</p> <p>Before, we attempt to get the linear system of equations, it would be helpful for notation purposes if we define</p> \[\begin{align*} A_{ji}= \int_0^1 \phi_i'(z) \phi_j'(z) dz \\ B_{ji}= \int_0^1 k^2 \phi_i(z) \phi_j(z) dz \\ \end{align*}\] <p>We then have</p> \[\begin{equation}\label{E6} \begin{split} &amp; (j=0) \\ &amp; [ A_{00} \alpha_0+ A_{01} \alpha_1+ \dots A_{05} \alpha_5]+ [B_{00} \alpha_0+ B_{01} \alpha_1+ \dots B_{05} \alpha_5]= 0 \\ &amp; (j=1) \\ &amp; [ A_{10} \alpha_0+ A_{11} \alpha_1+ \dots A_{15} \alpha_5]+ [B_{10} \alpha_0+ B_{11} \alpha_1+ \dots B_{15} \alpha_5]= 0 \\ \dots \\ &amp; (j=5) \\ &amp; [ A_{50} \alpha_0+ A_{51} \alpha_1+ \dots A_{55} \alpha_5]+ [B_{50} \alpha_0+ B_{51} \alpha_1+ \dots B_{55} \alpha_5]= 0 \end{split} \end{equation}\] <p>With \(A_{ij}\) as the elements of the matrix \(A\) and \(B_{ij}\) as the elements of the matrix \(B\), and \(\alpha\) as the vector of \(\alpha_i\)’s, we can write the above as:</p> \[[A+B]\alpha = 0\] <h2 id="getting-elements-of-the-linear-system">Getting elements of the linear system</h2> <p>While the eqn \eqref{E6} seems to involve a lot of calculations, in reality it is very easy. The following figure shows the functions for \(\phi_0, \phi_1, \phi_4 and \phi_5\).</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/hat2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/hat2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/hat2-1400.webp"></source> <img src="/assets/fem/hat2.png" class="img-fluid rounded z-depth-1" width="450" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Before evaluating the explicit integrals, it is noteworthy that the integrals will be non-zero only when both the functions in a region are non-zero. If either of them is zero, the product vanishes.</p> \[\begin{align*} A_{10} &amp;= \int_0^1 \phi_0'(z) \phi_1'(z) dz \\ &amp;= \int_0^{\Delta x} \phi_0'(z) \phi_1'(z) dz \quad \texttt{(The product vanishes everywhere else)}\\ &amp;= \phi_0'(z) \phi_1'(z) \int_0^{\Delta x} dz= \Delta x \times \frac{1}{\Delta x} \times \frac{-1}{\Delta x} = \frac{-1}{\Delta x}\\ A_{11} &amp;= \int_0^1 \phi_0'(z) \phi_0'(z) dz \\ &amp;= \int_0^{2 \Delta x} \phi_1'(z)^2 dz \quad \texttt{(The product vanishes everywhere else)}\\ &amp;= \phi_1'(z)^2 \int_0^{2 \Delta x} dz= \Delta x \times \frac{1}{(\Delta x)^2} = \frac{1}{\Delta x}\\ A_{51} &amp;= \int_0^1 \phi_1'(z) \phi_5'(z) dz \\ &amp;= 0 \quad \texttt{(The product vanishes everywhere)}\\ \end{align*}\] <p>Similarly, we have for \(B\) (note that \(k^2\) is constant in an element) \(\begin{align*} B_{10} &amp;= \int_0^1 k^2 \phi_0(z) \phi_1(z) dz \\ &amp;= \int_0^{\Delta x} k^2 \phi_0(z) \phi_1(z) dz \quad \texttt{(The product vanishes everywhere else)}\\ &amp;= k^2 \int_0^{\Delta x} \left(1- \frac{x}{\Delta x}\right) \left( \frac{x-0}{\Delta x} \right)dz= k^2 \bigg| \frac{x^2}{2\Delta x}- \frac{x^3}{3(\Delta x)^2}\bigg|_0^{\Delta x}= \frac{k^2 \Delta x}{6}\\ B_{11} &amp;= \int_0^1 k^2 \phi_1(z) \phi_1(z) dz \\ &amp;= \int_0^{\Delta x} k^2 \phi_1(z)^2 dz \quad \texttt{(The product vanishes everywhere else)}\\ &amp;= k^2 \int_0^{\Delta x} \left(\frac{x-0}{\Delta x}\right)^2 = k^2 \bigg| \frac{(x-0)^3}{3(\Delta x)^2}\bigg|_0^{\Delta x}= \frac{k^2 \Delta x}{3}\\ B_{51} &amp;= \int_0^1 \phi_1(z) \phi_5(z) dz \\ &amp;= 0 \quad \texttt{(The product vanishes everywhere)}\\ \end{align*}\)</p> <p>When we obtain the above for all elements, the matrices look like</p> \[\begin{align*} A= &amp; \left[ \begin{array}{cccccc} \frac{1}{\Delta x} &amp; \frac{-1}{\Delta x} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{-1}{\Delta x} &amp; \frac{2}{\Delta x} &amp; \frac{-1}{\Delta x} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp;\frac{-1}{\Delta x} &amp; \frac{2}{\Delta x} &amp; \frac{-1}{\Delta x} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{-1}{\Delta x} &amp; \frac{2}{\Delta x} &amp; \frac{-1}{\Delta x} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x} &amp; \frac{2}{\Delta x} &amp; \frac{-1}{\Delta x}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x} &amp; \frac{1}{\Delta x}\ \end{array} \right] \\ \\ B= &amp; \left[ \begin{array}{cccccc} \frac{k^2 \Delta x}{3} &amp; \frac{k^2 \Delta x}{6} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{k^2 \Delta x}{6} &amp; \frac{2 k^2 \Delta x}{3} &amp; \frac{k^2 \Delta x}{6} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \frac{k^2 \Delta x}{6} &amp; \frac{2 k^2 \Delta x}{3} &amp; \frac{k^2 \Delta x}{6} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{k^2 \Delta x}{6} &amp; \frac{2 k^2 \Delta x}{3} &amp; \frac{k^2 \Delta x}{6} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{k^2 \Delta x}{6} &amp; \frac{2 k^2 \Delta x}{3} &amp; \frac{k^2 \Delta x}{6}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{k^2 \Delta x}{6} &amp; \frac{k^2 \Delta x}{3}\ \end{array} \right] \end{align*}\] <p>For non-uniform grid spacing, the above modifies as</p> \[\begin{align*} A= &amp; \left[ \begin{array}{cccccc} \frac{1}{\Delta x_1} &amp; \frac{-1}{\Delta x_1} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{-1}{\Delta x_1} &amp; \frac{1}{\Delta x_1}+ \frac{1}{\Delta x_2} &amp; \frac{-1}{\Delta x_2} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \frac{-1}{\Delta x_2} &amp; \frac{1}{\Delta x_2}+ \frac{1}{\Delta x_3} &amp; \frac{-1}{\Delta x_3} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{-1}{\Delta x_3} &amp; \frac{1}{\Delta x_3}+ \frac{1}{\Delta x_4} &amp; \frac{-1}{\Delta x_4} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x_4} &amp; \frac{1}{\Delta x_4}+ \frac{1}{\Delta x_5} &amp; \frac{-1}{\Delta x_5}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x_5} &amp; \frac{1}{\Delta x_5}\ \end{array} \right] \\ \\ B= &amp; \left[ \begin{array}{cccccc} \frac{k^2 \Delta x_1}{3} &amp; \frac{k^2 \Delta x_1}{6} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{k^2 \Delta x_1}{6} &amp; \frac{k^2 \Delta x_1}{3}+ \frac{k^2 \Delta x_2}{3} &amp; \frac{k^2 \Delta x_2}{6} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \frac{k^2 \Delta x_2}{6} &amp; \frac{k^2 \Delta x_2}{3}+ \frac{k^2 \Delta x_3}{3} &amp; \frac{k^2 \Delta x_3}{6} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{k^2 \Delta x_3}{6} &amp; \frac{k^2 \Delta x_3}{3}+ \frac{k^2 \Delta x_4}{3} &amp; \frac{k^2 \Delta x_4}{6} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{k^2 \Delta x_4}{6} &amp; \frac{k^2 \Delta x_4}{3}+ \frac{k^2 \Delta x_5}{3} &amp; \frac{k^2 \Delta x_2}{5}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{k^2 \Delta x_5}{6} &amp; \frac{k^2 \Delta x_5}{3}\ \end{array} \right] \end{align*}\] <h2 id="boundary-conditions">Boundary Conditions</h2> <p>For 1D MT forward modeling, one can either put the a form of source field into the Maxwell’s equations. This, however, can be simplified for the 1D case, where the \(E\) field is typically set to 1 (or any constant) on the surface and noting the attenuating nature of the fields, it is safe to assume that \(E=0\) at the deepest point being modeled. To ensure that this does happen, we need to make the computational domain large enough, which is usually set to a few skin depths corresponding to the largest resistivity for a given frequency.</p> <h2 id="discretization">Discretization</h2> <p>One of the advantages of using finite element is that we can have non-uniform grid sizes. This allows us to have larger grid sizes whenever the structure is homogeneous and do a finer sampling whenever we come across structures/ inhomogeneities. In our case, we tested on a uniform grid spacing to draw comparisons in the matrix structure with finite differences. We then do a non-uniform sampling to show how finite element can be computationally efficient compared to the finite differences. Basing on the idea that we should have finer grid spacing near boundaries, we had the spacing that increase in arithematic progression starting from the edges until the center and then decreasing in the same order until the other edge. We apply this scheme for all the layers. This is schematically shown <a href="fe_nodes">here</a>.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/spacing-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/spacing-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/spacing-1400.webp"></source> <img src="/assets/fem/spacing.png" class="img-fluid rounded z-depth-1" width="450" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Nodes for discretization of the model space</figcaption> </figure> <p>Note that the above does not plot the depth on a log-scale to show the spacing in between the points, which otherwise gets skewed by the log function. Also, note that one can use any other discretization scheme that fits well with the objective. The one chosen here makes intuitive sense and may not be the best one but is a good one, as will also be shown in the next section.</p> <p>Since the last layer is treated as an infinite thickness layer, which is not computationally feasible, the common practice is to have its bottom depth extend until a few maximum skin depths for a given frequency. While this post contains the numerical framework, the codes can be accessed <a href="https://github.com/ayushinav/MT_1D" rel="external nofollow noopener" target="_blank">here</a>.</p> <h1 id="computational-comparison-to-finite-difference">Computational Comparison to Finite Difference</h1> <h2 id="matrix-structure">Matrix structure</h2> <p>For comparison with the finite differences, we make the grid size uniform for finite elements. The matrix to be inverted in finite element case is</p> \[\begin{align*} K= &amp; A+ B= \\ &amp; \left[ \begin{array}{cccccc} \frac{1}{\Delta x}+ \frac{k^2 \Delta x}{3} &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; \frac{2}{\Delta x}+ \frac{2 k^2 \Delta x}{3} &amp; \frac{-1}{\Delta x+ \frac{k^2 \Delta x}{6}} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp;\frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; \frac{2}{\Delta x}+ \frac{2 k^2 \Delta x}{3} &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; \frac{2}{\Delta x}+ \frac{2 k^2 \Delta x}{3} &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; \frac{2}{\Delta x}+ \frac{2 k^2 \Delta x}{3} &amp; \frac{-1}{\Delta x+ \frac{k^2 \Delta x}{6}}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{-1}{\Delta x}+ \frac{k^2 \Delta x}{6} &amp; \frac{1}{\Delta x}+ \frac{k^2 \Delta x}{3}\ \end{array} \right] \end{align*}\] <p>In finite differences, the matrix to be inverted had the form:</p> \[\begin{align*} K= \\ &amp; \left[ \begin{array}{cccccc} \frac{-1}{(\Delta x)^2} &amp; -k^2+ \frac{1}{\Delta x}^2 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\ \frac{1}{\Delta x} &amp; -k^2 - \frac{2}{(\Delta x)^2} &amp; \frac{1}{(\Delta x)^2} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; \frac{1}{\Delta x} &amp; -k^2 - \frac{2}{(\Delta x)^2} &amp; \frac{1}{(\Delta x)^2} &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{1}{\Delta x} &amp; -k^2 - \frac{2}{(\Delta x)^2} &amp; \frac{1}{(\Delta x)^2} &amp; 0\\ 0 &amp; 0 &amp; 0 &amp; \frac{1}{\Delta x} &amp; -k^2 - \frac{2}{(\Delta x)^2} &amp; \frac{1}{(\Delta x)^2}\\ 0 &amp; 0 &amp; 0 &amp; 0 &amp; -k^2+ \frac{1}{\Delta x}^2 &amp; \frac{-1}{(\Delta x)^2}\\ \end{array} \right] \end{align*}\] <p>The matrices look very similar, with both of them being tridiagonal. It is interesting to see that in finite element, the \(k^2\) term is also present in the non-diagonal terms while it is only present in the diagonal elements in the finite difference case.</p> <h2 id="error-analysis">Error analysis</h2> <p>Due to its flexibility, we expect finite element to be computationally efficient and/or providing better accuracy. We do a quantitative analysis to show how much the the difference between the two schemes is. We first define the error metric as:</p> \[\operatorname{err}(\rho_a)= \frac{1}{N} \sum_i \frac{|\rho_{analytical}^i- \rho_{numerical}^i|}{|\rho_{analytical}^i|} \times 100\] \[\operatorname{err}(\phi)= \frac{1}{N} \sum_i \frac{|\phi_{analytical}^i- \phi_{numerical}^i|}{|\phi_{analytical}^i|} \times 100\] <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/appres_err-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/appres_err-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/appres_err-1400.webp"></source> <img src="/assets/fem/appres_err.png" class="img-fluid rounded z-depth-1" width="650" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/phase_err-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/phase_err-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/phase_err-1400.webp"></source> <img src="/assets/fem/phase_err.png" class="img-fluid rounded z-depth-1" width="650" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>As can be evidently seen <a href="#err_appres">here</a> and <a href="#err_phase">here</a>, the finite element accumulates less errors compared to the finite difference method. Though the bigger highlight is that the finite element provides a better accuracy when compared to the finite element with more than an order of magnitude less number of points compared to the finite difference.</p> <h2 id="resolution-loss-in-discretization">Resolution loss in discretization</h2> <p>In finite differences, we are almost always constrained to have a uniform spacing. This leads us to choose a certain grid spacing for the whole space. This is usually chosen to be a small percentage of the minimum skin depth for a given frequency. This invariably leads to a loss in resolution because the layers may not necessarily end at a certain multiple of the grid spacing, as shown <a href="#disc">here</a></p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/fem/discretization-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/fem/discretization-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/fem/discretization-1400.webp"></source> <img src="/assets/fem/discretization.png" class="img-fluid rounded z-depth-1" width="550" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture><figcaption class="caption">Errors in model due to different discretization</figcaption> </figure> <p>In finite element, since we deal with the element spaces, we have the conductivity value known in all the element spaces. These element spaces are obviously homoegeneous and heterogeneities are captured by the node points. This allows us to get to the exact boundary structure.</p> <p>The idea can further be propagated to multiple dimensions, wherein we can reduce the difference the resolution loss because of the discretization. As a last note, we realize that this is not a huge difference that can error the forward model for MT very much, especially in 1D, but is definitely worth noting and can be significant when moving on to 2D and 3D.</p> <h1 id="conclusion">Conclusion</h1> <p>From the discussion so far, one can safely say that the finite element is more challenging to implement compared to the finite difference scheme. Since it allows the user to get flexible with the descritization, it needs to be implemented in the right way. The advantages, however, outweigh, the disadvantages. We can get a closer approximation to the resistivity distribution being modeled, which implies less resolution loss. The main highlight of finite element is that it allows us to use less number of grid points. Since both finite element and finite difference have the same tridiagonal matrix structure, the computational cost for inverting both the matrices will be the same, implying finite element will be orders of magnitude faster than the finite difference, as can be observed in the figures in the <a href="#error-analysis">Error analysis</a> section, where the finite element obtains the same accuracy in 10 times or even 100 times less node points.</p> <p>These advantages become more pronounced in 2D and 3D, where the number of node points increase dramatically, and also allow us to include topography into the model. Therefore, the use of finite elements over finite differences is encouraged.</p> <h1 id="acknowledgement">Acknowledgement</h1> <ul> <li>Thanks a lot to <a href="https://donglaiyang.org/" rel="external nofollow noopener" target="_blank">Dong Lai Yang</a> for starting me with FE methods.</li> <li>Class notes of Georgia Tech EAS 8803 Electromagnetic Methods course</li> <li><a href="https://ocw.mit.edu/courses/18-085-computational-science-and-engineering-i-fall-2008/video_galleries/video-lectures/" rel="external nofollow noopener" target="_blank">MIT 18.085 Computational Science and Engineering I</a></li> </ul> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Abhinav Pratap Singh. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>